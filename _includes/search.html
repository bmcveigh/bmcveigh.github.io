<span id="search">
        <a
        class="search-link"
        href="#"
        v-on:click="handleSearchClick"
    >
        <i class="fa fa-search"></i>
    </a>
    <div class="search-wrap" v-if="showSearch">
        <form action="">
             <input
                type="text"
                placeholder="Enter keywords..."
                v-on:keydown="handleKeyDown"
                v-on:keyup="handleKeyUp"
                autofocus
            />
        </form>
        <div class="search-results">
            <div class="search-result" 
                v-for="post in filteredPosts"
                >
                <a v-bind:href="post.url" v-text="post.title"></a>
            </div>
            <div v-if="!filteredPosts.length && keywords.length">
                <h3>No results found.</h3>
            </div>
            <div v-else-if="!filteredPosts.length && !keywords.length">
                <h3>Results will show up here as you type.</h3>
            </div>
        </div>
    </div>
</span>
<script>
    /**
     * Use VueJS to make the search functionality interactive.
     */
    var app = new Vue({
        el: '#search',
        data: {
            showSearch: false,
            keywords: '',
            posts: [],
            filteredPosts: [],
        },
        methods: {
            handleSearchClick: function(event) {
                event.preventDefault();
                this.showSearch = !this.showSearch;
            },
            handleKeyDown: (event) => {
                // If delete key is pressed, set the filtered posts to posts
                // so other results will still show up.
                if (event.which === 8) {
                    this.filteredPosts = this.posts;
                }
            },
            handleKeyUp: async function(event) {
                if (!this.posts.length) {
                    this.posts = await fetch('/api/posts.json')
                    .then(res => res.json())
                    .then(json => json)
                    .catch(error => {
                        // catch error.
                    });
                }
                
                this.keywords = event.target.value.toLowerCase();
                this.filteredPosts = [];

                if (!this.keywords.length) {
                    this.filteredPosts = [];
                    return;
                }

                for (const post of this.posts) {
                    if (post.title.toLowerCase().indexOf(this.keywords) > -1) {
                        this.filteredPosts.push(post);
                    }
                }
            }
        }
    });
</script>
